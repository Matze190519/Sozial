# ðŸ§ª LR VIRAL EMPIRE - FAULT-TOLERANT PARALLEL ARCHITECTURE TEST SUITE
# Version: 3.0.0 - Viral Research Integration + Circuit Breaker Testing
# Updated: 2025-08-17

## Test Categories

### 1. Dry Run Tests (Fault-Tolerant Architecture Validation)
### 2. Minimal Tests (Parallel APIs + Viral Research)  
### 3. Full Tests (Complete Fault-Tolerant Pipeline)
### 4. Edge Cases & Circuit Breaker Testing
### 5. Performance & Viral Research KPI Validation

---

## 1. ðŸƒ DRY RUN TESTS (FAULT-TOLERANT ARCHITECTURE)

### Test 1.1: Parallel Architecture Validation
```bash
# Objective: Verify fault-tolerant parallel architecture with 187+ nodes
# Expected: All nodes connected, parallel paths functional, no orphans

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "dry_run", "validate_structure": true}'
  -H "Content-Type: application/json" \
  -d '{"test_mode": "dry_run", "validate_architecture": true}'

# Success Criteria:
- âœ… Webhook trigger and parallel merge logic
- âœ… Environment variable validation with viral research variables
- âœ… Header Policy Linter (no headerParametersUi)
- âœ… Enhanced circuit breaker logic with viral content prioritization
- âœ… Cost tracking and budget gates with viral boost calculations
- âœ… Feature flags and brand defaults with viral research integration
- âœ… Viral score calculation and gating with +284% Crystal-Glas boost
- âœ… Parallel asset generation with failover paths
- âœ… Distribution channel routing with independent retry logic
- âœ… Viral research integration hub coordination
- âœ… Regional hook formula application (DE/ES/JP)
- âœ… WOW-Ideen implementation validation
- âœ… Final package assembly with fault tolerance
```

### Test 1.2: Circuit Breaker Logic Validation
```bash
# Objective: Test circuit breaker implementation without API calls
# Expected: Proper error handling, exponential backoff, viral priority

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "circuit_breaker_test", "simulate_failures": true}'

# Success Criteria:
- âœ… Circuit breakers open/close correctly
- âœ… Exponential backoff with viral content prioritization
- âœ… Higher error tolerance (8 vs 5) for viral content
- âœ… Retry logic functions properly
- âœ… System continues with partial failures
```

### Test 1.3: Viral Research Integration Test
```bash
# Objective: Validate viral research enhancement nodes
# Expected: All 5 viral enhancement nodes execute properly

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "viral_research_test", "mock_responses": true}'

# Success Criteria:
- âœ… Crystal-Glas enhancement (+284% boost factor)
- âœ… ASMR-Lion enhancement (TikTok DE viral)
- âœ… Impossible Physics enhancement (+156% share rate)
- âœ… WebAR-Portals enhancement (mobile-first AR)
- âœ… WOW-Ideen implementation (Top-12 impact)
- âœ… Regional hooks applied (DE/ES/JP)
```

## 2. ðŸ”¬ MINIMAL RUN (PARALLEL APIS + VIRAL RESEARCH)

### Test 2.1: Core Parallel Path Testing
**Purpose**: Test critical parallel paths with real API responses and viral research integration
**Duration**: 15-20 minutes
**Cost**: ~$5-8

#### APIs Tested (Parallel Execution):
- Perplexity Sonar Pro (trend analysis + impossible physics detection)
- Claude 3.5 Sonnet (content ideation + viral research integration)
- FLUX Dev (Crystal-Glas aesthetic generation +284% optimized)
- Remove.bg (background removal with viral content priority)
- ElevenLabs (ASMR-Lion whisper generation @432Hz)
- Google Sheets (logging with viral boost tracking)

```bash
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "minimal_parallel", "enable_viral_research": true}'
```

#### Success Criteria:
- âœ… All parallel API calls return 200 status with failover testing
- âœ… Circuit breakers handle API failures gracefully
- âœ… Viral research enhancement nodes execute successfully
- âœ… Crystal-Glas aesthetic prompts generate +284% optimized content
- âœ… ASMR-Lion content produces binaural audio @432Hz, -20 LUFS
- âœ… Regional hooks (DE/ES/JP) are properly applied
- âœ… Content ideation produces valid JSON with viral research integration
- âœ… Parallel execution paths complete without cascade failures
- âœ… Data logging functions with viral boost factor tracking

## 3. ðŸš€ FULL PRODUCTION RUN (FAULT-TOLERANT + VIRAL RESEARCH)

### Test 3.1: Complete Fault-Tolerant Pipeline
**Purpose**: Complete end-to-end test with fault tolerance and viral research integration
**Duration**: 45-60 minutes
**Cost**: ~$25-40

#### Full Parallel API Stack:
- All Scanner APIs in parallel (Perplexity, NewsAPI, YouTube, Google) with failover
- Complete Asset Forge with circuit breakers (FLUX, Runway, HeyGen, ElevenLabs, Tripo3D)
- All Distribution channels in parallel (Blotato, Predis, Klap, Simplified) with independent retry
- Viral Research Integration Hub with all 5 enhancement nodes
- Analytics and feedback systems (Metricool, HubSpot) with viral boost tracking
- WebAR generation and hosting with mobile-first optimization

```bash
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "full_production", "enable_all_features": true}'
```

#### Success Criteria:
- âœ… Complete fault-tolerant workflow execution with graceful error handling
- âœ… All 187+ nodes execute successfully with parallel processing
- âœ… Circuit breakers handle API failures without system crash
- âœ… Viral research integration produces enhanced content with boost factors
- âœ… Content meets enhanced viral score threshold with Crystal-Glas (+284%) boost
- âœ… All assets generated with viral research enhancements and hosted correctly
- âœ… Parallel distribution to all platforms successful with independent retry
- âœ… Regional hooks (DE/ES/JP) properly applied to content
- âœ… WOW-Ideen implementation successful (Kristall-LÃ¶wen-Augenreflex, etc.)
- âœ… Analytics data captured with viral boost factor tracking
- âœ… Final package contains all required elements with fault tolerance metadata
- âœ… Logo persistence â‰¥95% in all media with enhanced watermarking
- âœ… Compliance checks pass (no forbidden claims) with viral content validation
- âœ… Cost stays within budget limits with viral content prioritization
- âœ… System continues functioning even with individual node failures

## 4. ðŸ›¡ï¸ EDGE CASE TESTING (FAULT-TOLERANT ARCHITECTURE)

### API Failure Scenarios with Circuit Breakers
- **Perplexity Timeout**: Circuit breaker opens, fallback to cached trends, parallel scanner continues
- **Claude Rate Limit**: Enhanced circuit breaker with viral content priority, queue and retry with backoff
- **FLUX Generation Fail**: Circuit breaker triggers, fallback to alternative image service, Crystal-Glas enhancement preserved
- **Runway Timeout**: Circuit breaker opens, fallback to Luma Dream Machine, ASMR-Lion integration maintained
- **HeyGen Quota Exceeded**: Circuit breaker handles gracefully, skip avatar generation, continue parallel workflow
- **Distribution API Down**: Independent retry logic per channel, other channels continue unaffected
- **Multiple API Failures**: System continues with available services, viral content gets priority recovery
- **Circuit Breaker Cascade**: Enhanced logic prevents cascade failures, viral boost factor influences recovery

### Performance Testing (Parallel Architecture)
- **Parallel Execution**: Test 4 scanner paths + 5 asset lanes + 4 distribution channels simultaneously
- **Circuit Breaker Performance**: Validate exponential backoff and viral content prioritization
- **Memory Usage**: Monitor parallel node memory consumption and merge point efficiency
- **API Rate Limits**: Respect all service quotas with viral content priority handling
- **Timeout Handling**: Graceful degradation with failover paths and parallel continuation
- **Cost Optimization**: Track and optimize API usage costs with viral boost factor calculations
- **Fault Tolerance**: Validate system continues with partial failures across parallel paths
- **Viral Research Integration**: Test enhancement hub coordination and regional hook application

## 5. ðŸ“Š VIRAL RESEARCH KPI VALIDATION

### Viral Boost Factor Testing
```bash
# Test Crystal-Glas Aesthetic Enhancement (+284%)
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "viral_kpi", "focus": "crystal_glas", "measure_engagement": true}'

# Test ASMR-Lion Content (TikTok DE Viral)
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "viral_kpi", "focus": "asmr_lion", "measure_tiktok_de": true}'

# Test Impossible Physics (+156% Share-Rate)
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "viral_kpi", "focus": "impossible_physics", "measure_shares": true}'
```

### Regional Hook Performance
```bash
# Test DE Market Hooks
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "regional_hooks", "market": "DE", "hooks": ["POV: Du siehst zum ersten Mal..."]}'

# Test ES Market Hooks  
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "regional_hooks", "market": "ES", "hooks": ["Stell dir vor, dass..."]}'

# Test JP Market Hooks
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "regional_hooks", "market": "JP", "hooks": ["ä¿¡ã˜ã‚‰ã‚Œãªã„!"]}'
```

### WOW-Ideen Impact Measurement
```bash
# Test Kristall-LÃ¶wen-Augenreflex
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "wow_ideen", "focus": "kristall_lowen_augenreflex", "measure_impact": true}'

# Test Glass-Portal-WebAR
curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "wow_ideen", "focus": "glass_portal_webar", "measure_ar_engagement": true}'
```

---

## ðŸŽ¯ SUCCESS METRICS

### Fault Tolerance Metrics
- **System Uptime**: >99.5% even with individual node failures
- **Recovery Time**: <30 seconds for circuit breaker recovery
- **Parallel Efficiency**: >85% of nodes execute successfully in parallel
- **Failover Success**: >95% successful failover to backup services

### Viral Research Metrics
- **Crystal-Glas Boost**: Achieve +284% engagement increase
- **ASMR-Lion Performance**: Viral success on TikTok DE market
- **Impossible Physics**: +156% share rate improvement
- **WebAR Engagement**: 2.1x portal interaction rate
- **Regional Hook Effectiveness**: >80% hook success rate per market

### Quality Assurance
- **Logo Persistence**: â‰¥95% in all generated media
- **Audio Quality**: -20 LUFS Â±2, binaural @432Hz
- **Video Quality**: 9:16, 1080p, 8-12s, 24-30fps
- **Compliance**: 100% forbidden claims blocked
- **Cost Efficiency**: Stay within viral content priority budgets



# Success Criteria:
âœ… Node count: 150-190
âœ… All nodes connected (no orphans)
âœ… Proper n8n Cloud format
âœ… No headerParametersUi usage
```

### Test 1.2: Environment Variables Check
```bash
# Objective: Validate all required API keys and configs
# Expected: Complete environment setup

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "dry_run", "check_env": true}'

# Success Criteria:
âœ… All 70+ API keys present
âœ… Brand configuration complete
âœ… Logo URL accessible
âœ… Sheet IDs valid
âœ… Approval settings configured
```

### Test 1.3: Header Policy Compliance
```bash
# Objective: Ensure all HTTP nodes use Cloud-compliant headers
# Expected: No deprecated header formats

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{"test_mode": "dry_run", "lint_headers": true}'

# Success Criteria:
âœ… HeaderPolicy Linter passes
âœ… All HTTP nodes use headerParameters.parameters[]
âœ… No credentials blocks
âœ… Proper Content-Type headers
```

---

## 2. ðŸ”¬ MINIMAL TESTS

### Test 2.1: Core AI Pipeline
```bash
# Objective: Test essential AI components only
# APIs: Perplexity + Claude + FLUX (1 image)

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "minimal",
    "max_images": 1,
    "max_videos": 0,
    "skip_distribution": true,
    "skip_avatars": true
  }'

# Success Criteria:
âœ… Perplexity trends retrieved
âœ… Claude ideation successful
âœ… FLUX image generated
âœ… Viral score calculated
âœ… Cost under $0.25
```

### Test 2.2: Logo & Watermark System
```bash
# Objective: Verify logo pipeline and watermarking
# APIs: RemoveBG + Bannerbear

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "minimal",
    "test_logo_only": true,
    "logo_url_override": "https://example.com/test-logo.png"
  }'

# Success Criteria:
âœ… Logo fetched successfully
âœ… Background removed
âœ… Logo hosted and accessible
âœ… Watermark template ready
âœ… Etched-glass effect applied
```

### Test 2.3: Approval Flow
```bash
# Objective: Test WhatsApp + Telegram approval system
# APIs: Wassenger + Telegram

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "minimal",
    "test_approval_only": true,
    "auto_approve": false
  }'

# Success Criteria:
âœ… WhatsApp preview sent
âœ… Telegram preview sent
âœ… Approval buttons functional
âœ… Timeout handling works
âœ… Decision routing correct
```

---

## 3. ðŸš€ FULL TESTS

### Test 3.1: Complete Animal Lane
```bash
# Objective: Full Animal Lane (Lion) pipeline
# APIs: All core + Runway + HeyGen + ElevenLabs

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "full",
    "enable_animal_lane": true,
    "enable_portal_lane": false,
    "max_videos": 1,
    "auto_approve": true
  }'

# Success Criteria:
âœ… Lion cameo video generated (Runway Gen-4)
âœ… Impossible moment in first 2s
âœ… Logo watermark persistent (â‰¥95% frames)
âœ… ASMR audio track (-20 LUFS)
âœ… QC gates passed
âœ… Distribution successful
```

### Test 3.2: Complete Portal Lane
```bash
# Objective: Full Portal/Hologram pipeline
# APIs: All core + Luma + Tripo3D + WebAR

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "full",
    "enable_animal_lane": false,
    "enable_portal_lane": true,
    "enable_webxr": true,
    "auto_approve": true
  }'

# Success Criteria:
âœ… Crystal portal video (Luma Dream Machine)
âœ… 3D model generated (Tripo3D)
âœ… WebAR QR code functional
âœ… Volumetric lighting consistent
âœ… Portal edge stability verified
```

### Test 3.3: Avatar Dialogue System
```bash
# Objective: Full avatar system with dialogues
# APIs: HeyGen + ElevenLabs + Lip-sync

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "full",
    "test_avatars_only": true,
    "dialogue_type": "lina_mathias_60s",
    "voice_quality": "hyperreal"
  }'

# Success Criteria:
âœ… Lina avatar generated (HeyGen Avatar IV)
âœ… Mathias avatar generated
âœ… Dialogue lip-sync accurate (<80ms)
âœ… Voice quality hyperreal
âœ… Background swap functional
âœ… Motion studio effects applied
```

### Test 3.4: Distribution Quartet
```bash
# Objective: Test all 4 distribution platforms
# APIs: Blotato + Predis + Klap + Simplified

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "full",
    "test_distribution_only": true,
    "platforms": ["instagram", "facebook", "linkedin", "tiktok"],
    "schedule_delay_minutes": 5
  }'

# Success Criteria:
âœ… Blotato multi-posting successful
âœ… Predis captions generated
âœ… Klap reframes created (5 clips)
âœ… Simplified overlays applied
âœ… All platforms scheduled
âœ… Hashtag strategy implemented
```

---

## 4. âš ï¸ EDGE CASES & ERROR HANDLING

### Test 4.1: API Failures & Fallbacks
```bash
# Objective: Test resilience with API failures
# Scenario: Simulate Runway failure â†’ Luma fallback

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "edge_case",
    "simulate_failures": ["runway"],
    "enable_fallbacks": true
  }'

# Success Criteria:
âœ… Runway failure detected
âœ… Luma fallback triggered
âœ… Video still generated
âœ… Quality maintained
âœ… Cost tracking accurate
```

### Test 4.2: Low Viral Score Handling
```bash
# Objective: Test behavior with low viral scores
# Scenario: Viral score below threshold

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "edge_case",
    "force_low_viral_score": 50,
    "viral_threshold": 75
  }'

# Success Criteria:
âœ… Low score detected
âœ… Pipeline halted at gate
âœ… No resources wasted
âœ… Proper error message
âœ… Retry mechanism available
```

### Test 4.3: Cost Limit Exceeded
```bash
# Objective: Test cost guard functionality
# Scenario: Daily cost limit reached

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "edge_case",
    "simulate_high_cost": 150,
    "daily_limit": 100
  }'

# Success Criteria:
âœ… Cost limit detected
âœ… Pipeline stopped
âœ… Alert sent to admin
âœ… Remaining budget preserved
âœ… Next day reset functional
```

### Test 4.4: Compliance Violations
```bash
# Objective: Test forbidden claims detection
# Scenario: Content with prohibited phrases

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "edge_case",
    "inject_forbidden_claims": ["garantiert reich", "100% sicher"],
    "strict_compliance": true
  }'

# Success Criteria:
âœ… Forbidden claims detected
âœ… Content blocked
âœ… Violation logged
âœ… Alternative content suggested
âœ… Disclaimers added
```

---

## 5. ðŸ“Š PERFORMANCE & KPI VALIDATION

### Test 5.1: Speed Benchmarks
```bash
# Objective: Measure pipeline execution times
# Target: Complete run under 15 minutes

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "performance",
    "benchmark": true,
    "parallel_execution": true
  }'

# Success Criteria:
âœ… Total time < 15 minutes
âœ… Trend scanning < 2 minutes
âœ… Asset generation < 8 minutes
âœ… Distribution < 3 minutes
âœ… QC & packaging < 2 minutes
```

### Test 5.2: Viral Score Accuracy
```bash
# Objective: Validate viral score predictions
# Method: Compare with actual performance

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "performance",
    "validate_viral_scores": true,
    "historical_data": true
  }'

# Success Criteria:
âœ… Score accuracy >80%
âœ… High scores (>90) = viral content
âœ… Low scores (<70) = poor performance
âœ… Correlation with engagement
âœ… Predictive value confirmed
```

### Test 5.3: Resource Utilization
```bash
# Objective: Monitor system resource usage
# Target: Efficient API usage and cost control

curl -X POST /webhook/lr-run \
  -H "Content-Type: application/json" \
  -d '{
    "test_mode": "performance",
    "monitor_resources": true,
    "optimize_calls": true
  }'

# Success Criteria:
âœ… API calls minimized
âœ… Parallel execution optimized
âœ… Memory usage stable
âœ… No unnecessary retries
âœ… Cost per run <$5
```

### Test 5.4: Quality Consistency
```bash
# Objective: Ensure consistent output quality
# Method: Run 10 consecutive tests

for i in {1..10}; do
  curl -X POST /webhook/lr-run \
    -H "Content-Type: application/json" \
    -d '{
      "test_mode": "performance",
      "consistency_test": '$i',
      "quality_metrics": true
    }'
done

# Success Criteria:
âœ… All QC gates pass consistently
âœ… Visual quality stable
âœ… Audio quality consistent
âœ… Watermark always present
âœ… Compliance always maintained
```

---

## ðŸŽ¯ KPI TARGETS

### Viral Performance
- **Views**: 1B+ baseline target
- **Engagement Rate**: >5% average
- **Share Rate**: >2% (viral threshold)
- **Completion Rate**: >80%
- **Click-through Rate**: >3%

### Technical Performance
- **Pipeline Success Rate**: >95%
- **API Uptime**: >99%
- **Quality Gate Pass Rate**: >98%
- **Cost per Viral Hit**: <$50
- **Time to Market**: <15 minutes

### Content Quality
- **Visual Quality Score**: >8.5/10
- **Audio Quality Score**: >8.0/10
- **Brand Compliance**: 100%
- **Logo Visibility**: >95% frames
- **Watermark Persistence**: >95%

---

## ðŸš¨ CRITICAL TEST SCENARIOS

### Scenario A: Viral Breakthrough
```bash
# Test system under viral load (1M+ views/hour)
# Verify: Scaling, cost control, quality maintenance
```

### Scenario B: API Cascade Failure
```bash
# Test with multiple API failures simultaneously
# Verify: Graceful degradation, fallback chains
```

### Scenario C: Compliance Crisis
```bash
# Test with regulatory content challenges
# Verify: Immediate blocking, legal protection
```

### Scenario D: Competitor Response
```bash
# Test with similar content flooding market
# Verify: Differentiation, trend adaptation
```

---

## ðŸ“‹ TEST EXECUTION CHECKLIST

### Pre-Test Setup
- [ ] All API keys configured
- [ ] Test environment isolated
- [ ] Backup systems ready
- [ ] Monitoring enabled
- [ ] Cost limits set

### During Testing
- [ ] Real-time monitoring active
- [ ] Error logs captured
- [ ] Performance metrics recorded
- [ ] Quality samples saved
- [ ] Cost tracking enabled

### Post-Test Analysis
- [ ] Results documented
- [ ] Issues identified
- [ ] Performance analyzed
- [ ] Recommendations made
- [ ] Next steps planned

---

## ðŸ”§ DEBUGGING COMMANDS

### Check Node Connections
```bash
# Verify all nodes are properly connected
grep -c "connections" workflow.json
```

### Validate API Keys
```bash
# Test API connectivity
curl -H "Authorization: Bearer $anthropicApi" https://api.anthropic.com/v1/messages
```

### Monitor Costs
```bash
# Real-time cost tracking
curl -X GET /webhook/lr-run/costs
```

### Quality Inspection
```bash
# Download and inspect generated content
curl -X GET /webhook/lr-run/latest/assets
```

---

**Test Suite Version**: 1.0.0  
**Last Updated**: August 16, 2025  
**Compatibility**: n8n Cloud 1.60+

*"Testing is not about finding bugs, it's about ensuring viral success at scale."*
